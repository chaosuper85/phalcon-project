define("order/widget/view/order_trace/templete/order_trace_details/order_trace_details",function(require,exports,module){function windowOnLoad(){window.onload=function(){setLineHeight()}}function setLineHeight(){DOM.item_line=DOM.item.find(".line"),DOM.item_line.each(function(){var t=$(this),e=t.parent(".traceline").parent("li"),n=e.outerHeight();t.height(n)})}function showBoxDetail(t,e){var n=window.location.href,o=n.indexOf("#/"),i=n.substring(o+2,n.length);DOM.box_details.hide(),i&&!isNaN(i)&&1!=i&&DOM.box_details[i-1]?($(DOM.box_details[i-1]).show(),setLineHeight(),t[i-1]&&t[i-1].location_info?(setMapPoint({packing_point:t[i-1].location_info.chanzhuang,current_point:{lng:t[i-1].location_info.current.longitude||0,lat:t[i-1].location_info.current.latitude||0},drop_point:{lng:t[i-1].location_info.duichang.longitude||0,lat:t[i-1].location_info.duichang.latitude||0}},e),e.map.setFitView()):(e.clear(),DOM.trace_address.html("未定位到司机当前位置！"))):($(DOM.box_details[0]).show(),setLineHeight(),t[0]&&t[0].location_info?(setMapPoint({packing_point:t[0].location_info.chanzhuang,current_point:{lng:t[0].location_info.current.longitude||0,lat:t[0].location_info.current.latitude||0},drop_point:{lng:t[0].location_info.duichang.longitude||0,lat:t[0].location_info.duichang.latitude||0}},e),e.getAddressByPoint({point:{lng:t[0].location_info.current.longitude||0,lat:t[0].location_info.current.latitude||0}},function(t,e){DOM.trace_address.html(1==t?e.regeocode.formattedAddress:"未定位到司机当前位置！")}),e.map.setFitView()):(e.clear(),DOM.trace_address.html("未定位到司机当前位置！")))}function watchHashChange(t,e){window.onhashchange=function(){showBoxDetail(t,e)}}function setMapPoint(t,e){e.clear();var n=infoWindowTpl({info_class:"current",text_class:"",text:"当前位置"}),o=infoWindowTpl({info_class:"leave",text:"产装地址"}),i=infoWindowTpl({info_class:"normal",text:"落箱堆场"});if(t.current_point&&0!=t.current_point.lng&&0!=t.current_point.lat){{e.createMarker({point:t.current_point})}e.getAddressByPoint({point:t.current_point},function(t,e){DOM.trace_address.html(1==t?e.regeocode.formattedAddress:"未定位到司机当前位置！")})}else DOM.trace_address.html("未定位到司机当前位置！");if(t.packing_point&&0!==t.packing_point.length)for(var a=[],r=0;r<t.packing_point.length;r++){var l=t.packing_point[r];if(0!=l.latitude&&0!=l.longitude){var c=e.createBespokeMarker({point:{lng:l.longitude,lat:l.latitude},html:o,offset:{left:-50,top:-12}});c.on("mouseover",function(){var t=infoWindowTpl({info_class:"normal",text:"产装地址"});this.setContent(t),this.setTop(!0)}),c.on("mouseout",function(){var t=infoWindowTpl({info_class:"leave",text:"产装地址"});this.setContent(t),this.setTop(!1)}),a.push(c)}}if(t.drop_point&&0!=t.drop_point.lng&&0!=t.drop_point.lat){e.createBespokeMarker({point:t.drop_point,html:i,offset:{left:-50,top:-12}})}if(t.current_point&&0!=t.current_point.lng&&0!=t.current_point.lat){e.createInfoWindow({point:t.current_point,html:n,onOpenning:!0,offset:{left:2,top:3}})}}var infoWindowTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="trace-info" class="info ',"undefined"==typeof info_class?"":baidu.template._encodeHTML(info_class),'"><div class="text">',"undefined"==typeof text?"":baidu.template._encodeHTML(text),'</div><div class="square"></div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],Map=require("common/module/map/map.js"),DOM={item:$("#trace_details_content .content li"),box_details:$("#trace_details_content .details .box_detail"),trace_address:$("#trace_details_content .box_address span")};module.exports={init:function(t){var e=new Map("trace_map");windowOnLoad(),showBoxDetail(t,e),watchHashChange(t,e)}}});