define("order/widget/view/order_details/partial/box_info/box_info",function(require,exports,module){function bind(e,t,o,a){var r=new Cards({width:300});global_box=e,global_addressInfo=o;var n={$scope:$(".boxInfo-wrapper")},s=EnsupePop({data:{orderId:t}});n.$scope.on("click",".funcs a.add-ensupe",function(){{var e=$(this),o=e.parents("tr"),a=o.find("td"),r=e.attr("data-id");getBoxAddressIndex(r),$(a[1]),$(a[2])}s.setAdd({boxId:r}),s.show(),s.onComplete=function(){window.location.href="/order/details?orderid="+t+"&dispatch=2"}}),n.$scope.on("click",".funcs a.edit-ensupe",function(){var e=$(this),o=e.parents("tr"),a=o.find("td"),r=e.attr("data-id"),n=getBoxAddressIndex(r);if(!global_box[n].box_can_change)return void _alert("该箱子已经产装完成！");$(a[1]),$(a[2]);s.setEdit({boxId:r,orderId:t,boxNum:global_box[n].box_code,sealNum:global_box[n].box_ensupe}),s.show(),s.onComplete=function(){window.location.href="/order/details?orderid="+t+"&dispatch=2"}});var d=AssignPop({data:{orderId:t},carTeam_id:a,select_options:global_addressInfo});n.$scope.on("click",".funcs a.add-assign",function(){if(!d.can_open)return void _alert(d.msg);{var e=$(this),o=e.parents("tr"),a=o.find("td"),r=$(this).attr("data-id");getBoxAddressIndex(r),$(a[3]),$(a[4]),$(a[5])}d.setAdd(r),d.onComplete=function(){window.location.href="/order/details?orderid="+t+"&dispatch=2"},d.show()}),n.$scope.on("click",".funcs a.edit-assign",function(){if(!d.can_open)return void _alert(d.msg);{var e=$(this),o=e.parents("tr"),a=o.find("td"),r=$(this).attr("data-id"),n=getBoxAddressIndex(r);$(a[3]),$(a[4]),$(a[5])}d.setEdit(global_box[n]),d.onComplete=function(){window.location.href="/order/details?orderid="+t+"&dispatch=2"},d.show()});var i;n.$scope.on("mouseover",".funcs i.icon-status-message",function(e){var t=$(this),o=function(t){r.setContent('<p style="text-align:center;">正在加载中...</p>'),r.show(e);var o=t.attr("data-boxid"),a="";XDD.Request({url:"/order/boxtimeline",type:"get",data:{orderboxid:o},success:function(e){if(0==e.error_code){var t,o=e.data.length;if(o>0)for(t=0;o>t;t++)a+='<p><span style="margin-right:5px;">'+e.data[t].create_time+"</span>"+e.data[t].content+"</p>";else a='<p style="text-align:center;">暂无物流信息！</p>';r.setContent(a)}else r.setContent('<p style="text-align:center;">'+e.error_msg+"</p>")}})};i=setTimeout(function(){o(t)},800)}).on("mouseleave",".funcs i.icon-status-message",function(){clearTimeout(i),r.hide()}),n.$scope.on("click",".address-details a.complete",function(){var e,o=$(this),a=o.attr("data-aid"),r="";a&&(XDD.Request({url:"/order/assignStatus",type:"get",data:{assignId:a,orderId:t},success:function(t){if(0==t.error_code){if(e=t.data.status,2==e)r="司机未确认产装，是否确认产装？";else{if(100!=e)return;r="司机已确认产装，是否确认产装？"}confirm_Pop.setData(r),confirm_Pop.show()}else _alert(t.error_msg||"未知错误！")}}),confirm_Pop.onConfirm=function(){XDD.Request({url:"/carteam/order/driver_equipment_complete",data:{assign_id:a},success:function(e){0==e.error_code?(_alert("产装完成！"),window.location.reload()):_alert(e.error_msg||"未知错误！")}},!0)})})}function getBoxAddressIndex(e){if(global_box&&e){var t,o,a=global_box.length;for(o=0;a>o;o++)global_box[o].box_id==e&&(t=o);return t}}var EnsupePop=require("order/module/ensupe_pop/ensupe_pop.js"),AssignPop=require("order/module/assign_pop/assign_pop.js"),Cards=require("common/module/cards/cards.js"),select=require("common/module/select/select.js"),box_details_tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<ul class="box-no-complete '),length===i+1&&_template_fun_array.push("last"),_template_fun_array.push('"><li class="clearfix"><div class="address-content"><p class="address">',"undefined"==typeof box_address_detail?"":baidu.template._encodeHTML(box_address_detail),'</p><p class="time">',"undefined"==typeof box_time?"":baidu.template._encodeHTML(box_time),'</p></div><a href="javascript:;" class="complete" data-aid="',"undefined"==typeof assign_driver_id?"":baidu.template._encodeHTML(assign_driver_id),'">产装完成</a></li></ul>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],Confirm=require("common/module/confirm/confirm.js"),global_box,global_addressInfo,confirm_Pop=new Confirm;module.exports={init:function(e,t,o,a){bind(e,t,o,a)}}});