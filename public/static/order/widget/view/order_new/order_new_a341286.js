define("order/widget/view/order_new/order_new",function(e,n,a){function t(e,n){function a(e){for(var n=0;w>n;n++){var a=e[n].carteamId,t=e[n].carteamName;x[n]={text:t,value:a}}}function t(e,n){var a=$(e).parent(".btn-wrap"),t=$(a).prev(".upload-show"),o=$(t).find(".filename");$(t).removeClass("hidden"),$(o).html(n)}function i(e){var n=$(e).prev(".show-box"),a=$(n).parent(".upload-show"),t=$(n).children(".filename"),o=$(a).parent(".item-content").next(".item-message"),i=$(o).children(".right-message");$(t).html(""),$(a).addClass("hidden"),$(i).addClass("hidden")}function d(e){var n=e.split("."),a=n.length-1;return"doc"==n[a]||"docx"==n[a]||"pdf"==n[a]?!0:(_alert("您上传的文件格式不正确！请重新上传！"),!1)}function s(e){var n=$(e),a=n.val();return a?a:!1}function l(e){var n=$(e),a=n.val();return/^(\d|[a-zA-Z])+$/.test(a)?a:!1}function c(){var e=S.val();return e}function h(e){{var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".error-message");$(a).children(".right-message")}$(t).removeClass("hidden")}function u(e){var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".china-notice"),o=$(a).children(".right-message");$(t).removeClass("hidden"),$(o).addClass("hidden")}function m(e){var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".error-message"),o=$(a).children(".china-notice"),i=$(a).children(".right-message");$(e).removeClass("error"),$(t).addClass("hidden"),$(i).removeClass("hidden"),$(o).addClass("hidden")}var g,f,v,_,p,w=e.length,x=[],C=n,b=new Date,z=b.getFullYear(),j=b.getMonth()+1,D=b.getDate();p="日期："+z+"-"+(10>j?"0"+j:j)+"-"+(10>D?"0"+D:D),$(".number-left").html(p),console.log("aaa="+p),a(e);var S=new o({container:"#carteam-selector",width:500,heigth:34,options:x,defaultText:"请选择",defaultValue:"0"});$("#upload-chanzhuang").AjaxFileUpload({action:"/api/freight/order/upload_chanzhuang",onSubmit:function(){r.show({btn:$("#order-new .chanzhuang_btn"),txt:"正在上传...",showLoad:!1})},onComplete:function(e,n){console.log(e,n),r.hide();var a=d(e);a&&(t("#upload-chanzhuang",e),f=n.data.pic_url)},onError:function(){r.hide()}}),$("#upload-tixiang").AjaxFileUpload({action:"/api/freight/order/upload_tixiang",onSubmit:function(){r.show({btn:$("#order-new .tixiang_btn"),txt:"正在上传...",showLoad:!1})},onComplete:function(e,n){console.log(e,n);var a=d(e);r.hide(),a&&(t("#upload-tixiang",e),_=n.data.pic_url)},onError:function(){r.hide()}}),$("#chanzhuang-delete").on("click",function(){i("#chanzhuang-delete"),f=""}),$("#tixiang-delete").on("click",function(){i("#tixiang-delete"),_=""}),$("#tidan_name").blur(function(){var e=$("#tidan_name").val(),n=s("#tidan_name"),a=l("#tidan_name");if(!n)return h("#tidan_name"),$("#tidan_name").focus(),void $("#tidan_name").addClass("error");if(m("#tidan_name"),""!=e||null!=e){if(!a)return u("#tidan_name"),$("#tidan_name").focus(),void $("#tidan_name").addClass("error");m("#tidan_name")}}),$(".order-creat").on("click",function(){var e=$(this);return g=c(),v=s("#tidan_name"),_tidanString=l("#tidan_name"),"0"==g?(h(".select-box"),$(".select-box").focus(),void $(".select-box").addClass("error")):($(".select-box").removeClass("error"),m(".select-box"),f?(m(".chanzhuang-show"),v?(m("#tidan_name"),_tidanString?(m("#tidan_name"),_?(m(".tixiang-show"),r.show({btn:e,txt:"正在创建订单...",showLoad:!1}),void XDD.Request({url:"/freight/order/new",data:{tidan:v,yundan:C,carteamId:g,tixiang:_,chanzhuang:f},success:function(e){0==e.error_code?(_alert("提交成功，请等待审核"),window.location.href="/order/list"):(_alert(e.error_msg),1002==e.error_code&&setTimeout("window.location.href = '/freight/order/choose'",2e3)),r.hide()}},!0)):void h(".tixiang-show")):(u("#tidan_name"),$("#tidan_name").focus(),void $("#tidan_name").addClass("error"))):(h("#tidan_name"),$("#tidan_name").focus(),void $("#tidan_name").addClass("error"))):void h(".chanzhuang-show"))})}e("common/module/upload/uploader.js");var o=e("common/module/select/select.js"),i=e("common/module/loadingBtn/loadingBtn.js"),r=new i;a.exports={init:function(e,n){t(e,n)}}});