define("order/widget/view/order_new/order_new",function(e,n,a){function t(e,n){function a(e){for(var n=0;p>n;n++){var a=e[n].carteamId,t=e[n].carteamName;w[n]={text:t,value:a}}}function t(e,n){var a=$(e).parent(".btn-wrap"),t=$(a).prev(".upload-show"),i=$(t).find(".filename");$(t).removeClass("hidden"),$(i).html(n)}function r(e){var n=$(e).prev(".show-box"),a=$(n).parent(".upload-show"),t=$(n).children(".filename"),i=$(a).parent(".item-content").next(".item-message"),r=$(i).children(".right-message");$(t).html(""),$(a).addClass("hidden"),$(r).addClass("hidden")}function o(e){var n=$(e),a=n.val();return a?a:!1}function s(e){var n=$(e),a=n.val();return/^(\d|[a-zA-Z])+$/.test(a)?a:!1}function c(){var e=A.val();return e}function l(e){{var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".error-message");$(a).children(".right-message")}$(t).removeClass("hidden")}function h(e){var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".china-notice"),i=$(a).children(".right-message");$(t).removeClass("hidden"),$(i).addClass("hidden")}function m(e){var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".ajax-notice"),i=$(a).children(".right-message");$(t).removeClass("hidden"),$(i).addClass("hidden")}function u(e){var n=$(e).parents(".item-content"),a=$(n).next(".item-message"),t=$(a).children(".error-message"),i=$(a).children(".china-notice"),r=$(a).children(".right-message"),d=$(a).children(".ajax-notice");$(e).removeClass("error"),$(t).addClass("hidden"),$(r).removeClass("hidden"),$(i).addClass("hidden"),$(d).addClass("hidden")}var g,f,_,v,x,p=e.length,w=[],C=n,b=new Date,j=b.getFullYear(),z=b.getMonth()+1,D=b.getDate();x="日期："+j+"-"+(10>z?"0"+z:z)+"-"+(10>D?"0"+D:D),$(".number-left").html(x),console.log("aaa="+x),a(e);var A=new i({container:"#carteam-selector",width:500,heigth:34,options:w,defaultText:"请选择",defaultValue:"0"});$("#upload-chanzhuang").AjaxFileUpload({action:"/api/freight/order/upload_chanzhuang",onSubmit:function(){d.show({btn:$("#order-new .chanzhuang_btn"),txt:"正在上传...",showLoad:!1})},onComplete:function(e,n){console.log(e,n),d.hide(),n.data.pic_url&&(t("#upload-chanzhuang",e),f=n.data.pic_url)},onError:function(){d.hide()}}),$("#upload-tixiang").AjaxFileUpload({action:"/api/freight/order/upload_tixiang",onSubmit:function(){d.show({btn:$("#order-new .tixiang_btn"),txt:"正在上传...",showLoad:!1})},onComplete:function(e,n){console.log(e,n),d.hide(),n.data.pic_url&&(t("#upload-tixiang",e),v=n.data.pic_url)},onError:function(){d.hide()}}),$("#chanzhuang-delete").on("click",function(){r("#chanzhuang-delete"),f=""}),$("#tixiang-delete").on("click",function(){r("#tixiang-delete"),v=""}),$("#tidan_name").keyup(function(){var e=$(this),n=e.val();n.replace(/\s/g,"")}),$("#tidan_name").blur(function(){var e=$(this),n=e.val().replace(/\s/g,""),a=o("#tidan_name"),t=s("#tidan_name"),i=e.parents(".item-content").next(".item-message");if(!a)return l("#tidan_name"),i.children(".right-message").hide(),i.children(".ajax-notice").hide(),$("#tidan_name").focus(),void $("#tidan_name").addClass("error");if(u("#tidan_name"),""!=n||null!=n){if(!t)return h("#tidan_name"),i.children(".right-message").hide(),i.children(".ajax-notice").hide(),$("#tidan_name").focus(),void $("#tidan_name").addClass("error");u("#tidan_name")}else i.children(".china-notice").hide(),i.children(".error-message").show();XDD.Request({url:"/freight/order/ladingCodeExist?tidanCode="+a,success:function(e){0==e.error_code?(i.children(".right-message").show(),i.children(".ajax-notice").hide()):(i.children(".ajax-notice").show(),i.children(".right-message").hide(),$("#tidan_name").addClass("error"))}})}),$(".order-creat").on("click",function(){var e=$(this);return g=c(),_=o("#tidan_name"),_tidanString=s("#tidan_name"),"0"==g?(l(".select-box"),$(".select-box").focus(),void $(".select-box").addClass("error")):($(".select-box").removeClass("error"),u(".select-box"),f?(u(".chanzhuang-show"),_?(u("#tidan_name"),_tidanString?(u("#tidan_name"),v?(u(".tixiang-show"),d.show({btn:e,txt:"正在创建...",showLoad:!1}),e.attr("disabled","disabled"),void XDD.Request({url:"/freight/order/ladingCodeExist?tidanCode="+_,success:function(n){0==n.error_code?XDD.Request({url:"/freight/order/new",data:{tidan:_,yundan:C,carteamId:g,tixiang:v,chanzhuang:f},success:function(n){0==n.error_code?(_alert("提交成功，请等待审核"),window.location.href="/order/list"):(_alert(n.error_msg),1002==n.error_code&&setTimeout("window.location.href = '/freight/order/choose'",2e3)),d.hide(),e.removeAttr("disabled")},error:function(){d.hide(),e.removeAttr("disabled")}},!0):(m("#tidan_name"),$("#tidan_name").focus(),obj_this.parents(".item-content").next(".item-message").children(".right-message").hide(),$("#tidan_name").addClass("error"),d.hide(),e.removeAttr("disabled"))},error:function(){d.hide(),e.removeAttr("disabled")}})):void l(".tixiang-show")):(h("#tidan_name"),$("#tidan_name").focus(),void $("#tidan_name").addClass("error"))):(l("#tidan_name"),$("#tidan_name").focus(),void $("#tidan_name").addClass("error"))):void l(".chanzhuang-show"))})}e("common/module/upload/uploader.js");var i=e("common/module/select/select.js"),r=e("common/module/loadingBtn/loadingBtn.js"),d=new r;a.exports={init:function(e,n){t(e,n)}}});