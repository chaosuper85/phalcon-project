define("user/widget/view/account_company/company",function(e,t,n){function o(e){function t(e){{var t=e.split(".");t.length-1}return!0}function n(e){var t=$("#licenseNumber").val();XDD.Request({url:"/account/licenceCodeExist",data:{licenceCode:t},success:function(t){"function"==typeof e&&e(t)}},!0)}function o(e,t){if(t)var n=h.val(),o=n.city.id;else var o=w.val();return o>0?(g=1,o):(g=0,!1)}function s(e){var t=$(e),n=t.val();return n?(g=1,n):(g=0,!1)}function u(){var e=B.val(),t=new Date(e.replace("-","/").replace("-","/")),n=new Date,o="";o+=n.getFullYear()+"-",o+=n.getMonth()+1+"-",o+=n.getDate()+"-";var c=new Date(o.replace("-","/").replace("-","/"));return t>c?(console.log(e),g=0,!1):(g=1,e)}function m(e){var t=$(e).val();return t&&a.isNumber(t)?(g=1,t):(g=0,!1)}function d(e){$(e).animate({marginLeft:"-1px"},40).animate({marginLeft:"2px"},40).animate({marginLeft:"-2px"},40).animate({marginLeft:"1px"},40).animate({marginLeft:"0px"},40).focus()}function f(e){var t=$(e).closest(".content").siblings(".tip");$(t).removeClass("invisible"),$(t).children("i").removeClass("i-right"),g=0}function v(e){var t=$(e).closest(".content").siblings(".tip"),n=t.children("i");$(t).removeClass("invisible"),$(n).addClass("i-right")}var p,b,g=0,h=new c({wrap:"#address-selector",level:2,width:160,height:40}),_="货代用户",y="车队用户";"2"==e?b=_:"1"==e&&(b=y);var M,x,w=new i({container:"#type-selector",options:[{text:"货代用户",value:"2"},{text:"车队用户",value:"1"}],defaultText:b,defaultValue:e,height:40}),j=new Date,N=+j.getFullYear(),B=new r({wrap:"#company_date_selectBox",ed_year:N,width:70,height:40});$("#upload-license").AjaxFileUpload({onComplete:function(e,n){console.log(e,n);var o=t(e);o&&($("#img-license").attr("src",n.data.pic_url),M=n.data.pic_url,$(".img-license-content").removeClass("hidden"),v(".img-license-content"))}}),$("#img-clean").on("click",function(){$("#img-license").attr("src",""),$(".img-license-content").addClass("hidden"),f(".img-license-content"),M="",g=0}),$(".license").on("click",function(){var e=$(".license").attr("src");window.open(e)}),$("#submitInfo").on("click",function(){var e=s("#enterpriseName");if(!e)return d("#enterpriseName"),void f("#enterpriseName");v("#enterpriseName");var t=o("#type-selector");if(!t)return d("#type-selector"),void f("#type-selector");console.log("选择了",t),v("#type-selector"),"1"==t?t="carteam":"2"==t&&(t="freight_agent"),console.log("类型 = "+t);var c=o("#address-selector","1");if(!c)return d("#address-selector"),void f("#address-selector");v("#address-selector");var i=u("#company_date_selectBox");if(!i)return d("#company_date_selectBox"),void f("#company_date_selectBox");v("#company_date_selectBox");var r=m("#contactMobile-city");if(!r)return d("#contactMobile-city"),void f("#contactMobile-city");if(3!=r.length&&4!=r.length)return d("#contactMobile-city"),void f("#contactMobile-city");v("#contactMobile-city");var a=m("#contactMobile-number");if(!a)return d("#contactMobile-number"),void f("#contactMobile-number");if(7!=a.length&&8!=a.length)return d("#contactMobile-number"),void f("#contactMobile-number");v("#contactMobile-number");var b=m("#contactMobile-fenji");if(b){if(b.length<3||b.length>5)return d("#contactMobile-fenji"),void f("#contactMobile-fenji");v("#contactMobile-fenji")}else v("#contactMobile-fenji"),console.log("fenji=",b);var h=m("#licenseNumber");return h?void n(function(n){function o(){$("#confirmBtn").on("click",function(){s($(this)),p.hide()}),$("#cancelBtn").on("click",function(){console.log("cancle"),p.hide(),$("#confirmBtn").unbind("click")})}function s(n){var o=n.text();n.html("正在提交..."),n.attr("disabled","disabled"),XDD.Request({url:"/account/do_apply",data:{enterpriseName:e,type:t,cityCode:c,builddate:i,contactMobile_city:r,contactMobile_number:a,contactMobile_fenji:b,licenceNumber:h,licencePic:x},success:function(e){0==e.error_code?(_alert("提交成功，请等待审核"),$(".pop-close").on("click",function(){location.href="/account/enterpriseInfo"}),$(".popup-bg").on("click",function(){location.href="/account/enterpriseInfo"})):_alert(e.error_msg),n.html(o),n.removeAttr("disabled")},error:function(){n.html(o),n.removeAttr("disabled")}},!0)}return 0==n.error_code?(g=1,v("#licenseNumber")):(_alert(n.error_msg),g=0,d("#licenseNumber"),f("#licenseNumber")),0!=g?(x=M?M:$("#img-license").attr("src"),console.log(i+"---------"+x),x?(g=1,v("#img-license"),0==g?!1:void(1==g&&(p?p.show():(p=new l,p.setData("公司信息一经提交，不能修改"),p.show()),o()))):(f("#img-license"),void(g=0))):void 0}):(d("#licenseNumber"),void f("#licenseNumber"))})}e("common/module/upload/uploader.js");var c=e("common/module/address/address.js"),i=e("common/module/select/select.js"),r=e("common/module/selectTimeBox/selectTimeBox.js"),l=e("common/module/confirm/confirm.js"),a=e("common/module/util.js");n.exports={init:function(e){o(e)}}});