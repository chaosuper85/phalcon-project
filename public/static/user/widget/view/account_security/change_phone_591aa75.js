define("user/widget/view/account_security/change_phone",function(e,s,t){function n(){function e(){"pass"==f?$("#step-one-pass").show():"sms"==f&&$("#step-one-sms").show()}function s(e){var s=$("#step-one-password").val(),t=o.isPassword(s);return s.length?s.length<6?(p("#step-one-password"),void d(".tip-pass","密码为6-16位")):t?($(".tip-pass").html(""),s):(p("#step-one-password"),void d(".tip-pass","密码必须包含字母和数字")):e?void d(".tip","请输入密码"):void 0}function t(){XDD.Request({type:"GET",url:"/user/sendSms",data:{smsType:"NORMAL_AUTH"},success:function(e){if(0==e.error_code){_alert("已向您的手机发送了短信，请注意查收");var s=60,t=function(){1==s?($("#get-sms").html("重发短信"),$("#get-sms").removeClass("disable"),clearTimeout(n)):(s--,$("#get-sms").html("重发("+s+")"),$("#get-sms").addClass("disable"),setTimeout(t,1e3))},n=setTimeout(t,1e3)}else _alert(e.error_msg)}})}function n(e){var s=$("#change-phone-sms").val();return s.length?4!==s.length?(d(".tip-sms","请输入4位短信验证码"),void p("#change-phone-sms")):o.isNumber(s)?($(".tip-sms").html(""),s):(d(".tip-sms","短信验证码为4位数字"),void p("#change-phone-sms")):e?(d(".tip-sms","请输入短信验证码"),void p("#change-phone-sms")):void 0}function i(){$(".nav-one").removeClass("current").addClass("finshed"),$(".nav-two").addClass("current"),$("#step-one-sms").hide(),$("#step-one-pass").hide(),$("#step-two").show()}function a(e){var s=$("#new-mobile").val();return s?11!==s.length?(p("#new-mobile"),void d(".tip-newmobile","请输入11位手机号")):o.isMobilePhone(s)?s:(p("#new-mobile"),void d(".tip-newmobile","请输入正确的手机号")):e?(p("#new-mobile"),void d(".tip-newmobile","请输入手机号")):(p("#new-mobile"),void d(".tip-newmobile","请输入手机号"))}function r(e,s,t){XDD.Request({type:"GET",url:"/index/checkExist",data:{mobileOrName:s},success:function(e){"function"==typeof t&&t(e)}})}function m(){var e=a();XDD.Request({type:"GET",url:"/user/sendSms",data:{mobile:e,smsType:"CHANGE_MOBILE"},success:function(e){if(0==e.error_code){_alert("已向您的手机发送了短信，请注意查收");var s=60,t=function(){1==s?($("#get-new-sms").html("重发短信"),$("#get-new-sms").removeClass("disable"),clearTimeout(n)):(s--,$("#get-new-sms").html("重发("+s+")"),$("#get-new-sms").addClass("disable"),setTimeout(t,1e3))},n=setTimeout(t,1e3)}else _alert(e.error_msg)}})}function l(e){var s=$("#new-phone-sms").val();return s.length?4!==s.length?(d(".tip-newsms","请输入4位短信验证码"),p("#new-phone-sms"),!1):o.isNumber(s)?($(".tip-sms").html(""),s):(d(".tip-newsms","短信验证码为4位数字"),p("#new-phone-sms"),!1):e?(d(".tip-newsms","请输入短信验证码"),void p("#new-phone-sms")):void 0}function c(){$(".nav-two").removeClass("current").addClass("finshed"),$(".nav-three").addClass("current"),$("#step-two").hide(),$("#step-three").show(),u()}function u(){var e=5,s=function(){1==e?(window.location.href="/account/accountSecurity",clearTimeout(t)):(e--,$("#next-step-three").html(e+"S跳转"),setTimeout(s,1e3))},t=setTimeout(s,1e3)}function d(e,s){$(e).html(s),$(e).addClass("red")}function p(e){$(e).animate({marginLeft:"-1px"},40).animate({marginLeft:"2px"},40).animate({marginLeft:"-2px"},40).animate({marginLeft:"1px"},40).animate({marginLeft:"0px"},40).focus()}var h=window.location.href,f=h.split("?")[1];e(),$(".next-step-one").on("click",function(){if("pass"==f){var e=s(1);e&&XDD.Request({url:"/user/validatePwd",data:{pwd:e},success:function(e){console.log(e),0==e.error_code?i():_alert(e.error_msg)}})}else if("sms"==f){var t=n(1);t&&XDD.Request({url:"/user/validateSmsCode",type:"GET",data:{code:t},success:function(e){console.log(e),0==e.error_code?i():_alert(e.error_msg)}})}}),$("#get-sms").on("click",function(){var e=$(this).hasClass("disable");e||t()}),$("#get-new-sms").on("click",function(){var e=a();e&&($(".tip-newmobile").html("正在检查手机号可用性..."),r(".tip-newmobile",e,function(e){if(0==e.error_code){d(".tip-newmobile","手机号可用"),$("#new-mobiletip").removeClass("red");var s=$("#get-new-sms").hasClass("disable");if(s)return!1;m()}else d(".tip-newmobile","手机号已被注册（或不可用）"),p("#new-mobile")}))}),$("#next-step-two").on("click",function(){var e=a(1),s=l(1);e&&s&&XDD.Request({url:"/user/changeBind",data:{code:s,mobile:e},success:function(e){console.log(e),0==e.error_code?(_alert("修改成功!"),c()):_alert(e.error_msg)}})})}var o=e("common/module/util.js");t.exports={init:function(){n()}}});