define("user/widget/view/account_security/change_phone",function(e,s,t){function n(){function e(){"pass"==v?$("#step-one-pass").show():"sms"==v&&$("#step-one-sms").show()}function s(e){var s=$("#step-one-password").val(),t=o.isPassword(s);return s.length?s.length<6?(p("#step-one-password"),void u(".tip-pass","密码为6-16位")):t?($(".tip-pass").html(""),s):(p("#step-one-password"),void u(".tip-pass","密码必须包含字母和数字")):e?void u(".tip","请输入密码"):void 0}function t(){XDD.Request({type:"GET",url:"/user/sendSms",data:{smsType:"NORMAL_AUTH"},success:function(e){if(0==e.error_code){_alert("已向您的手机发送了短信，请注意查收");var s=60,t=function(){1==s?($("#get-sms").html("重发短信"),$("#get-sms").removeClass("disable"),clearTimeout(n)):(s--,$("#get-sms").html("重发("+s+")"),$("#get-sms").addClass("disable"),setTimeout(t,1e3))},n=setTimeout(t,1e3)}else _alert(e.error_msg)}})}function n(e){var s=$("#change-phone-sms").val();return s.length?4!==s.length?(u(".tip-sms","请输入4位短信验证码"),void p("#change-phone-sms")):o.isNumber(s)?($(".tip-sms").html(""),s):(u(".tip-sms","短信验证码为4位数字"),void p("#change-phone-sms")):e?(u(".tip-sms","请输入短信验证码"),void p("#change-phone-sms")):void 0}function i(){$(".nav-one").removeClass("current").addClass("finshed"),$(".nav-two").addClass("current"),$("#step-one-sms").hide(),$("#step-one-pass").hide(),$("#step-two").show()}function r(e){var s=$("#new-mobile").val();return s?11!==s.length?(p("#new-mobile"),void u(".tip-newmobile","请输入11位手机号")):o.isMobilePhone(s)?s:(p("#new-mobile"),void u(".tip-newmobile","请输入正确的手机号")):e?(p("#new-mobile"),void u(".tip-newmobile","请输入手机号")):(p("#new-mobile"),void u(".tip-newmobile","请输入手机号"))}function a(e,s,t){XDD.Request({type:"GET",url:"/index/checkExist",data:{mobileOrName:s},success:function(e){"function"==typeof t&&t(e)}})}function l(){var e=r();XDD.Request({type:"GET",url:"/user/sendSms",data:{mobile:e,smsType:"CHANGE_MOBILE"},success:function(e){if(0==e.error_code){_alert("已向您的手机发送了短信，请注意查收");var s=60,t=function(){1==s?($("#get-new-sms").html("重发短信"),$("#get-new-sms").removeClass("disable"),clearTimeout(n)):(s--,$("#get-new-sms").html("重发("+s+")"),$("#get-new-sms").addClass("disable"),setTimeout(t,1e3))},n=setTimeout(t,1e3)}else _alert(e.error_msg)}})}function m(e){var s=$("#new-phone-sms").val();return s.length?4!==s.length?(u(".tip-newsms","请输入4位短信验证码"),p("#new-phone-sms"),!1):o.isNumber(s)?($(".tip-sms").html(""),s):(u(".tip-newsms","短信验证码为4位数字"),p("#new-phone-sms"),!1):e?(u(".tip-newsms","请输入短信验证码"),void p("#new-phone-sms")):void 0}function d(){$(".nav-two").removeClass("current").addClass("finshed"),$(".nav-three").addClass("current"),$("#step-two").hide(),$("#step-three").show(),c()}function c(){var e=5,s=function(){1==e?(window.location.href="/account/accountSecurity",clearTimeout(t)):(e--,$("#next-step-three").html(e+"S跳转"),setTimeout(s,1e3))},t=setTimeout(s,1e3)}function u(e,s){$(e).html(s),$(e).addClass("red")}function p(e){$(e).animate({marginLeft:"-1px"},40).animate({marginLeft:"2px"},40).animate({marginLeft:"-2px"},40).animate({marginLeft:"1px"},40).animate({marginLeft:"0px"},40).focus()}var h=window.location.href,v=h.split("?")[1];e(),$(".next-step-one").on("click",function(){var e=$(this);if("pass"==v){var t=s(1);if(t){var o=e.text();e.html("正在提交..."),e.attr("disabled","disabled"),XDD.Request({url:"/user/validatePwd",data:{pwd:t},success:function(s){console.log(s),0==s.error_code?i():_alert(s.error_msg),e.html(o),e.removeAttr("disabled")},error:function(){e.html(o),e.removeAttr("disabled")}})}}else if("sms"==v){var r=n(1);if(r){var o=e.text();e.html("正在提交..."),e.attr("disabled","disabled"),XDD.Request({url:"/user/validateSmsCode",type:"GET",data:{code:r,smsType:"NORMAL_AUTH"},success:function(s){console.log(s),0==s.error_code?i():_alert(s.error_msg),e.html(o),e.removeAttr("disabled")},error:function(){e.html(o),e.removeAttr("disabled")}})}}}),$("#get-sms").on("click",function(){var e=$(this).hasClass("disable");e||t()}),$("#get-new-sms").on("click",function(){var e=r();e&&($(".tip-newmobile").html("正在检查手机号可用性..."),a(".tip-newmobile",e,function(e){if(0==e.error_code){u(".tip-newmobile","手机号可用"),$("#new-mobiletip").removeClass("red");var s=$("#get-new-sms").hasClass("disable");if(s)return!1;l()}else u(".tip-newmobile","手机号已被注册（或不可用）"),p("#new-mobile")}))}),$("#next-step-two").on("click",function(){var e=r(1),s=m(1),t=$(this),n=t.text();t.html("正在修改..."),t.attr("disabled","disabled"),e&&s&&XDD.Request({url:"/user/changeBind",data:{code:s,mobile:e,smsType:"CHANGE_MOBILE"},success:function(e){console.log(e),0==e.error_code?(_alert("修改成功!"),d()):_alert(e.error_msg),t.html(n),t.removeAttr("disabled")},error:function(){t.html(n),t.removeAttr("disabled")}})})}var o=e("common/module/util.js");t.exports={init:function(){n()}}});