define("index/widget/view/reg/reg",function(e,s,r){function t(){var e=1;g.FORM.code.blur(function(){var e=i();e&&(g.TIPS.code.html("正在检查邀请码..."),n("code",e,function(s){0==s.error_code?d("code",e,"邀请码可用"):(p("code","请联系箱典典官方客服400-969-6790获取邀请码"),v("code"))}))}),g.FORM.type.find(".radio-box").click(function(){var e=$(this);if(!e.hasClass("active")){e.addClass("active"),e.siblings(".radio-box").removeClass("active");var s=e.attr("type");g.FORM.type.attr("type",s)}}),g.FORM.username.blur(function(){var e=a();e&&(g.TIPS.username.html("正在检查用户名可用性..."),c("username",e,function(s){0==s.error_code?d("username",e,"用户名可用"):p("username","用户名已被注册（或不可用）")}))}),g.FORM.mobile.blur(function(){var e=o();e&&(g.TIPS.mobile.html("正在检查手机号可用性..."),c("mobile",e,function(s){0==s.error_code?d("mobile",e,"手机号可用"):p("mobile","手机号已被注册（或不可用）")}))}),g.FORM.mobile.keyup(function(e){var s=e.keyCode;37!=s&&38!=s&&39!=s&&40!=s&&g.FORM.mobile.val(g.FORM.mobile.val().replace(/\D/gi,""))}),g.BTNS.sms.click(function(){if(!g.BTNS.sms.hasClass("disable"))if(S.mobile)g.BTNS.sms.html("发送中..."),f(R.mobile);else{var e=o();e?(g.BTNS.sms.html("发送中..."),c("mobile",e,function(s){0==s.error_code?f(e):(g.BTNS.sms.html("发送短信"),p("mobile","手机号已被注册（或不可用）"),v("mobile"))})):v("mobile")}}),g.FORM.sms.blur(function(){m()}),g.FORM.pass.blur(function(){l()}),g.FORM.repass.blur(function(){u()}),g.BTNS.submit.click(function(){var s=i(1);if(s&&(g.TIPS.code.html("正在检查邀请码..."),n("code",s,function(r){0==r.error_code?(e=0,d("code",s,"邀请码可用"),console.log("status=",e)):(e=1,p("code","请联系箱典典官方客服400-969-6790获取邀请码"),v("code"))})),1!=e){var r=g.FORM.type.attr("type");if("freight_agent"!=r&&"carteam"!=r)return void p("type","请选择用户类型");d("type",r);var t={type:r},c=a(1);if(!c)return void v("username");t.userName=c;var f=o(1);if(!f)return void v("mobile");t.mobile=f;var b=m(1);if(!b)return void v("sms");t.smsCode=b;var S=l(1),R=u(1);if(!S)return void v("pass");if(!R)return void v("repass");if(t.pwd=R,!g.FORM.agreement[0].checked)return void _alert("请阅读并同意服务条款");g.BTNS.submit.html("正在注册..."),XDD.Request({url:"/user/do_register",data:t,success:function(e){0==e.error_code?location.href="/account/enterpriseInfo":(_alert(e.error_msg),g.BTNS.submit.html("立即注册"))},error:function(){g.BTNS.submit.html("立即注册")}})}})}function i(e){var s=g.FORM.code,r=s.val();return r?r:e?(v("code"),p("code","请联系箱典典官方客服400-969-6790获取邀请码"),!1):!1}function n(e,s,r){S[e]=!1,R[e]="",XDD.Request({type:"POST",url:"/user/checkregister",data:{register_code:s},success:function(e){"function"==typeof r&&r(e)}},!0)}function a(e){var s=g.FORM.username,r=s.val().replace(/\s{1,}/g,"").toLowerCase();return s.val(r),r?r.length<4?(p("username","用户名不少于4位"),!1):r.length>12?(p("username","用户名不多于12位"),!1):b.isUname(r)?r:(p("username","4-12位字母或数字，首字符不能为数字"),!1):e?(p("username","请输入用户名"),!1):!1}function o(e){var s=g.FORM.mobile,r=s.val();return r?11!==r.length?(p("mobile","请输入11位手机号"),!1):b.isMobilePhone(r)?r:(p("mobile","请输入正确的手机号"),!1):e?(p("mobile","请输入手机号"),!1):!1}function m(e){var s=g.FORM.sms,r=s.val();return r.length?4!==r.length?(p("sms","请输入4位短信验证码"),!1):b.isNumber(r)?(d("sms",r),r):(p("sms","短信验证码为4位数字"),!1):e?(p("sms","请输入短信验证码"),!1):!1}function l(e){var s=g.FORM.pass,r=s.val(),t=g.FORM.repass.val();return r.length?r.length<6||r.length>12?(p("pass","密码为6-16位"),!1):b.isPassword(r)?(t==r&&d("repass",t),d("pass",r),r):(p("pass","密码必须包含数字和字母"),!1):e?(p("pass","请输入密码"),!1):!1}function u(e){var s=g.FORM.repass,r=s.val(),t=g.FORM.pass.val();return r.length?r!==t?(p("repass","两次输入密码不一致"),!1):(d("repass",r),r):e?(p("repass","请再次输入密码"),!1):!1}function c(e,s,r){S[e]=!1,R[e]="",XDD.Request({type:"GET",url:"/index/checkExist",data:{mobileOrName:s},success:function(e){"function"==typeof r&&r(e)}})}function f(e){XDD.Request({type:"GET",url:"/user/sendSms",data:{mobile:e,smsType:"REGISTER"},success:function(e){if(0==e.error_code){_alert("已向您的手机发送了短信，请注意查收"),g.BTNS.sms.addClass("disable");var s=60,r=function(){1==s?(g.BTNS.sms.html("重发短信"),g.BTNS.sms.removeClass("disable"),clearTimeout(t)):(s--,g.BTNS.sms.html("重发("+s+")"),setTimeout(r,1e3))},t=setTimeout(r,1e3)}}})}function d(e,s,r){var t=r?r:T[e];g.TIPS[e].removeClass("red"),g.TIPS[e].html(t),g.PASS_MARKS[e].removeClass("invisible"),"pass"!=e&&(S[e]=!0,R[e]=s)}function p(e,s){g.TIPS[e].html(s),g.TIPS[e].addClass("red"),g.PASS_MARKS[e].addClass("invisible"),S[e]=!1,R[e]=""}function v(e){g.FORM[e].animate({marginLeft:"-1px"},40).animate({marginLeft:"2px"},40).animate({marginLeft:"-2px"},40).animate({marginLeft:"1px"},40).animate({marginLeft:"0px"},40).focus()}var b=e("common/module/util.js"),g={FORM:{code:$("#reg-code"),type:$("#reg-type"),username:$("#reg-username"),mobile:$("#reg-mobile"),sms:$("#reg-sms"),pass:$("#reg-pass"),repass:$("#reg-repass"),agreement:$("#reg-agree")},TIPS:{},PASS_MARKS:{},BTNS:{sms:$("#get-sms"),submit:$("#reg-submit")}},S={},R={};for(var h in g.FORM)g.TIPS[h]=g.FORM[h].siblings(".tip"),g.PASS_MARKS[h]=g.FORM[h].siblings(".right-mark"),S[h]=!1;var T={type:"请选择用户类型",username:"4-12位字母或数字，首字符不能为数字",mobile:"可用于登录系统，找回密码",sms:"请查收手机短信，并填写短信中的验证码",pass:"6～16位字符，区分大小写",repass:"请再次输入密码"};r.exports={init:function(){t()}}});